<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Vamo Command Center - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --neon-blue: #00f5ff;
            --neon-purple: #8a2be2;
            --neon-gold: #ffd700;
            --dark-bg: #0a0a0f;
            --card-bg: rgba(16, 20, 31, 0.85);
            --glass-border: rgba(0, 245, 255, 0.3);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 245, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(138, 43, 226, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .command-center {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 0 50px rgba(0, 245, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .neon-text {
            font-family: 'Orbitron', monospace;
            text-shadow: 
                0 0 10px currentColor,
                0 0 20px currentColor,
                0 0 30px currentColor;
        }

        .stat-card {
            background: linear-gradient(135deg, 
                rgba(0, 245, 255, 0.1) 0%, 
                rgba(255, 215, 0, 0.1) 50%, 
                rgba(138, 43, 226, 0.1) 100%);
            border: 1px solid rgba(0, 245, 255, 0.3);
            backdrop-filter: blur(15px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(0, 245, 255, 0.2), 
                transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 10px 30px rgba(0, 245, 255, 0.3),
                0 0 50px rgba(0, 245, 255, 0.2);
        }

        .btn-neon {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
            border: none;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-neon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: left 0.3s;
        }

        .btn-neon:hover::before {
            left: 100%;
        }

        .btn-neon:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 10px 25px rgba(0, 245, 255, 0.4),
                0 0 30px rgba(0, 245, 255, 0.6);
        }

        .modal-futuristic {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .modal-futuristic.show {
            display: flex;
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-content-futuristic {
            background: var(--card-bg);
            border: 2px solid var(--neon-blue);
            box-shadow: 
                0 0 50px rgba(0, 245, 255, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .status-badge-futuristic {
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            border: 1px solid;
            backdrop-filter: blur(10px);
        }

        .status-en-attente { 
            background: rgba(255, 193, 7, 0.2); 
            color: var(--neon-gold); 
            border-color: var(--neon-gold);
            text-shadow: 0 0 10px var(--neon-gold);
        }
        .status-approuve { 
            background: rgba(0, 255, 0, 0.2); 
            color: #00ff00; 
            border-color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        .status-rejete { 
            background: rgba(255, 0, 0, 0.2); 
            color: #ff0040; 
            border-color: #ff0040;
            text-shadow: 0 0 10px #ff0040;
        }
        .status-suspendu { 
            background: rgba(255, 165, 0, 0.2); 
            color: #ff6500; 
            border-color: #ff6500;
            text-shadow: 0 0 10px #ff6500;
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--neon-blue);
            animation: float 20s infinite linear;
            opacity: 0.3;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.3;
            }
            90% {
                opacity: 0.3;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .data-table {
            background: rgba(16, 20, 31, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.2);
        }

        .data-table th {
            background: rgba(0, 245, 255, 0.1);
            color: var(--neon-blue);
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
        }

        .data-table tr:hover {
            background: rgba(0, 245, 255, 0.05);
        }

        .hidden { display: none !important; }

        .search-container {
            position: relative;
        }

        .search-input {
            background: rgba(16, 20, 31, 0.8);
            border: 1px solid var(--neon-blue);
            color: white;
            padding: 0.75rem 1rem 0.75rem 3rem;
            font-family: 'Orbitron', monospace;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.5);
        }

        .chart-container {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
        }
    </style>
</head>
<body>
    <!-- Particules flottantes -->
    <div class="floating-particles" id="particles"></div>

    <!-- Header Command Center -->
    <div class="relative z-10 w-full p-6">
        <div class="command-center rounded-3xl p-8">
            <!-- En-t√™te principal -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-4xl font-bold neon-text text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-500 to-yellow-400">
                        üöÄ VAMO COMMAND CENTER
                    </h1>
                    <p class="text-blue-300 mt-2 font-mono">System Status: ONLINE | Neural Network: ACTIVE | AI Core: OPERATIONAL</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="initiateScanSequence()" class="btn-neon text-white px-6 py-3 rounded-lg font-bold">
                        üîç SCAN SYSTEM
                    </button>
                    <button onclick="refreshAllData()" class="btn-neon text-white px-6 py-3 rounded-lg font-bold">
                        ‚ôªÔ∏è REFRESH DATA
                    </button>
                    <div class="w-4 h-4 bg-green-400 rounded-full animate-pulse shadow-lg shadow-green-400/50" title="System Online"></div>
                </div>
            </div>

            <!-- Statistics Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-300 text-sm font-mono uppercase tracking-wider">CHAUFFEURS</p>
                            <p id="stats-chauffeurs" class="text-3xl font-bold neon-text text-blue-400">0</p>
                            <p class="text-xs text-gray-400 mt-1">
                                Actifs: <span id="chauffeurs-actifs" class="text-green-400">0</span>
                            </p>
                        </div>
                        <div class="text-4xl">üöó</div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-300 text-sm font-mono uppercase tracking-wider">LIVREURS</p>
                            <p id="stats-livreurs" class="text-3xl font-bold neon-text text-purple-400">0</p>
                            <p class="text-xs text-gray-400 mt-1">
                                En ligne: <span id="livreurs-actifs" class="text-green-400">0</span>
                            </p>
                        </div>
                        <div class="text-4xl">üèçÔ∏è</div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-300 text-sm font-mono uppercase tracking-wider">REVENUS/JOUR</p>
                            <p id="stats-revenus" class="text-3xl font-bold neon-text text-yellow-400">0 ‚Ç¨</p>
                            <p class="text-xs text-gray-400 mt-1">
                                Courses: <span id="courses-jour" class="text-green-400">0</span>
                            </p>
                        </div>
                        <div class="text-4xl">üí∞</div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-300 text-sm font-mono uppercase tracking-wider">EN ATTENTE</p>
                            <p id="stats-attente" class="text-3xl font-bold neon-text text-green-400">0</p>
                            <p class="text-xs text-gray-400 mt-1">
                                Validation requise
                            </p>
                        </div>
                        <div class="text-4xl">‚è≥</div>
                    </div>
                </div>
            </div>

            <!-- Graphiques Analytics -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="chart-container rounded-xl p-6">
                    <h3 class="text-xl font-bold text-blue-300 mb-4 font-mono">üìä REVENUS HEBDOMADAIRES</h3>
                    <canvas id="revenusChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-container rounded-xl p-6">
                    <h3 class="text-xl font-bold text-purple-300 mb-4 font-mono">üìà ACTIVIT√â SYST√àME</h3>
                    <canvas id="activiteChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Recherche et Filtres -->
            <div class="command-center rounded-xl p-6 mb-8">
                <h3 class="text-xl font-bold text-cyan-300 mb-4 font-mono">üîç CENTRE DE CONTR√îLE</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="Rechercher..." 
                               class="search-input w-full rounded-lg">
                        <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-blue-400">üîç</div>
                    </div>
                    <select id="statusFilter" class="search-input rounded-lg">
                        <option value="">Tous les statuts</option>
                        <option value="en_attente">En attente</option>
                        <option value="approuve">Approuv√©</option>
                        <option value="rejete">Rejet√©</option>
                        <option value="suspendu">Suspendu</option>
                    </select>
                    <select id="typeFilter" class="search-input rounded-lg">
                        <option value="">Chauffeurs & Livreurs</option>
                        <option value="chauffeurs">Chauffeurs uniquement</option>
                        <option value="livreurs">Livreurs uniquement</option>
                    </select>
                    <button onclick="executeSearch()" class="btn-neon text-white px-6 py-3 rounded-lg font-bold">
                        RECHERCHER
                    </button>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="flex space-x-4 mb-6 border-b border-blue-500/30">
                <button onclick="showSection('chauffeurs')" id="tab-chauffeurs" 
                        class="px-6 py-3 font-mono font-bold text-blue-300 hover:text-blue-100 border-b-2 border-transparent hover:border-blue-400 transition-all">
                    üöó CHAUFFEURS
                </button>
                <button onclick="showSection('livreurs')" id="tab-livreurs" 
                        class="px-6 py-3 font-mono font-bold text-purple-300 hover:text-purple-100 border-b-2 border-transparent hover:border-purple-400 transition-all">
                    üèçÔ∏è LIVREURS
                </button>
                <button onclick="showSection('analytics')" id="tab-analytics" 
                        class="px-6 py-3 font-mono font-bold text-yellow-300 hover:text-yellow-100 border-b-2 border-transparent hover:border-yellow-400 transition-all">
                    üìä ANALYTICS
                </button>
            </div>

            <!-- Section Chauffeurs -->
            <div id="section-chauffeurs" class="data-table rounded-xl overflow-hidden">
                <div class="p-6 border-b border-blue-500/30">
                    <h3 class="text-2xl font-bold text-blue-300 font-mono">üöó GESTION CHAUFFEURS</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-blue-500/30">
                                <th class="px-6 py-4 text-left">ID</th>
                                <th class="px-6 py-4 text-left">CHAUFFEUR</th>
                                <th class="px-6 py-4 text-left">CONTACT</th>
                                <th class="px-6 py-4 text-left">V√âHICULE</th>
                                <th class="px-6 py-4 text-left">STATUT</th>
                                <th class="px-6 py-4 text-left">REVENUS</th>
                                <th class="px-6 py-4 text-left">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="chauffeurs-tbody" class="divide-y divide-blue-500/20">
                            <tr>
                                <td colspan="7" class="px-6 py-12 text-center text-blue-300">
                                    <div class="flex flex-col items-center">
                                        <div class="animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mb-4"></div>
                                        <p class="font-mono">SCANNING CHAUFFEURS DATABASE...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Section Livreurs -->
            <div id="section-livreurs" class="data-table rounded-xl overflow-hidden hidden">
                <div class="p-6 border-b border-purple-500/30">
                    <h3 class="text-2xl font-bold text-purple-300 font-mono">üèçÔ∏è GESTION LIVREURS</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-purple-500/30">
                                <th class="px-6 py-4 text-left">ID</th>
                                <th class="px-6 py-4 text-left">LIVREUR</th>
                                <th class="px-6 py-4 text-left">CONTACT</th>
                                <th class="px-6 py-4 text-left">V√âHICULE</th>
                                <th class="px-6 py-4 text-left">STATUT</th>
                                <th class="px-6 py-4 text-left">LIVRAISONS</th>
                                <th class="px-6 py-4 text-left">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="livreurs-tbody" class="divide-y divide-purple-500/20">
                            <tr>
                                <td colspan="7" class="px-6 py-12 text-center text-purple-300">
                                    <div class="flex flex-col items-center">
                                        <div class="animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full mb-4"></div>
                                        <p class="font-mono">SCANNING LIVREURS DATABASE...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Section Analytics -->
            <div id="section-analytics" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container rounded-xl p-6">
                        <h3 class="text-xl font-bold text-yellow-300 mb-4 font-mono">üí∞ REVENUS MENSUELS</h3>
                        <canvas id="revenusMensuelChart" width="400" height="300"></canvas>
                    </div>
                    <div class="chart-container rounded-xl p-6">
                        <h3 class="text-xl font-bold text-green-300 mb-4 font-mono">üéØ TOP CHAUFFEURS</h3>
                        <div id="topChauffeurs" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Futuriste -->
    <div id="modalFuturistic" class="modal-futuristic">
        <div class="modal-content-futuristic rounded-2xl p-8 m-4">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalTitle" class="text-2xl font-bold neon-text text-blue-300 font-mono"></h3>
                <button onclick="closeFuturisticModal()" class="text-red-400 hover:text-red-300 text-3xl font-bold transition-colors">√ó</button>
            </div>
            <div id="modalContent" class="text-gray-300">
                <!-- Contenu du modal -->
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ VAMO COMMAND CENTER - NEURAL NETWORK ACTIVATED');
        console.log('üîã System Status: ONLINE');
        console.log('üéØ Mission: CONTROL ALL OPERATIONS');
        
        // Configuration API
        const API_BASE = 'https://vamo-backend-production.up.railway.app/api';
        const API_ADVANCED_BASE = 'https://vamo-backend-production.up.railway.app/api/admin-advanced';
        
        let authToken = null;
        let systemData = {
            chauffeurs: [],
            livreurs: [],
            analytics: {},
            searchResults: {}
        };

        // Initialisation du syst√®me
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Command Center...');
            createFloatingParticles();
            initializeCharts();
            authenticateAndLoad();
            showSection('chauffeurs');
            
            // Event listeners pour la recherche
            document.getElementById('searchInput').addEventListener('input', debounce(executeSearch, 300));
            document.getElementById('statusFilter').addEventListener('change', executeSearch);
            document.getElementById('typeFilter').addEventListener('change', executeSearch);
        });

        // Cr√©ation des particules flottantes
        function createFloatingParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // Authentification et chargement initial
        async function authenticateAndLoad() {
            try {
                console.log('üîê Authenticating admin access...');
                
                const response = await fetch(`${API_BASE}/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@vamo.sn',
                        password: 'VamoAdmin2024'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    authToken = data.token;
                    console.log('‚úÖ Authentication successful');
                    await loadAllSystemData();
                } else {
                    console.error('‚ùå Authentication failed');
                    showErrorNotification('Erreur d\'authentification');
                }
            } catch (error) {
                console.error('‚ùå Network error:', error);
                // Fallback vers les endpoints debug
                await loadBasicData();
            }
        }

        // Chargement de toutes les donn√©es syst√®me
        async function loadAllSystemData() {
            try {
                console.log('üì° Loading system data...');
                
                // Charger donn√©es de base et analytics en parall√®le
                const [basicData, analyticsData] = await Promise.all([
                    loadBasicData(),
                    loadAnalytics()
                ]);
                
                console.log('‚úÖ All system data loaded');
                updateDashboardStats();
                
            } catch (error) {
                console.error('‚ùå Error loading system data:', error);
                showErrorNotification('Erreur de chargement des donn√©es');
            }
        }

        // Chargement des donn√©es de base
        async function loadBasicData() {
            try {
                const [chauffeurResponse, livreurResponse] = await Promise.all([
                    fetch(`${API_BASE}/debug/chauffeurs`),
                    fetch(`${API_BASE}/debug/livreurs`)
                ]);
                
                const chauffeurData = await chauffeurResponse.json();
                const livreurData = await livreurResponse.json();
                
                if (chauffeurData.success) {
                    systemData.chauffeurs = chauffeurData.chauffeurs;
                    displayChauffeurs(chauffeurData.chauffeurs);
                }
                
                if (livreurData.success) {
                    systemData.livreurs = livreurData.livreurs;
                    displayLivreurs(livreurData.livreurs);
                }
                
                return { chauffeurData, livreurData };
                
            } catch (error) {
                console.error('‚ùå Error loading basic data:', error);
                throw error;
            }
        }

        // Chargement des analytics
        async function loadAnalytics() {
            try {
                if (!authToken) return null;
                
                const response = await fetch(`${API_ADVANCED_BASE}/analytics/dashboard`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        systemData.analytics = data.analytics;
                        updateChartsWithData(data.analytics);
                        return data.analytics;
                    }
                }
                
                return null;
                
            } catch (error) {
                console.error('‚ùå Error loading analytics:', error);
                return null;
            }
        }

        // Mise √† jour des statistiques du dashboard
        function updateDashboardStats() {
            const chauffeurs = systemData.chauffeurs;
            const livreurs = systemData.livreurs;
            
            // Statistiques chauffeurs
            const chauffeursApprouves = chauffeurs.filter(c => c.statut_validation === 'approuve').length;
            const chauffeursActifs = chauffeurs.filter(c => c.disponibilite).length;
            const chauffeursAttente = chauffeurs.filter(c => c.statut_validation === 'en_attente').length;
            
            // Statistiques livreurs
            const livreursApprouves = livreurs.filter(l => l.statut_validation === 'approuve').length;
            const livreursActifs = livreurs.filter(l => l.disponibilite).length;
            const livreursAttente = livreurs.filter(l => l.statut_validation === 'en_attente').length;
            
            // Mise √† jour de l'interface
            document.getElementById('stats-chauffeurs').textContent = chauffeurs.length;
            document.getElementById('chauffeurs-actifs').textContent = chauffeursActifs;
            document.getElementById('stats-livreurs').textContent = livreurs.length;
            document.getElementById('livreurs-actifs').textContent = livreursActifs;
            document.getElementById('stats-attente').textContent = chauffeursAttente + livreursAttente;
            
            // Animation des compteurs
            animateCounters();
        }

        // Animation des compteurs
        function animateCounters() {
            const counters = document.querySelectorAll('[id^="stats-"]');
            counters.forEach(counter => {
                counter.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    counter.style.transform = 'scale(1)';
                }, 200);
            });
        }

    </script>
    
    <!-- Include advanced functions -->
    <script src="futuristic-functions.js"></script>
</body>
</html>